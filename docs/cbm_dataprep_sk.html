<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 CBM_dataPrep_SK | CBM Spades Manual</title>
<meta name="author" content="">
<meta name="description" content="3.1 Overview This module is to read-in user-provided information or provide defaults. It reads-in rasters (ageRaster, ecoRaster, gcIndexRaster, spuRaster, and masterRaster) from either defaults of...">
<meta name="generator" content="bookdown 0.40 with bs4_book()">
<meta property="og:title" content="Chapter 3 CBM_dataPrep_SK | CBM Spades Manual">
<meta property="og:type" content="book">
<meta property="og:description" content="3.1 Overview This module is to read-in user-provided information or provide defaults. It reads-in rasters (ageRaster, ecoRaster, gcIndexRaster, spuRaster, and masterRaster) from either defaults of...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 CBM_dataPrep_SK | CBM Spades Manual">
<meta name="twitter:description" content="3.1 Overview This module is to read-in user-provided information or provide defaults. It reads-in rasters (ageRaster, ecoRaster, gcIndexRaster, spuRaster, and masterRaster) from either defaults of...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="v. 0.1">CBM Spades Manual</a>:
        <small class="text-muted">v. 0.1</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="cbm_defaults.html"><span class="header-section-number">2</span> CBM_defaults</a></li>
<li><a class="active" href="cbm_dataprep_sk.html"><span class="header-section-number">3</span> CBM_dataPrep_SK</a></li>
<li><a class="" href="cbm_vol2biomass.html"><span class="header-section-number">4</span> CBM_vol2biomass</a></li>
<li><a class="" href="cbm_core.html"><span class="header-section-number">5</span> CBM_Core</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/camillegiuliano/CBMspadesManual">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cbm_dataprep_sk" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> CBM_dataPrep_SK<a class="anchor" aria-label="anchor" href="#cbm_dataprep_sk"><i class="fas fa-link"></i></a>
</h1>
<div id="overview-1" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-1"><i class="fas fa-link"></i></a>
</h2>
<p>This module is to read-in user-provided information or provide defaults.
It reads-in rasters (<code>ageRaster</code>, <code>ecoRaster</code>, <code>gcIndexRaster</code>, <code>spuRaster</code>, and <code>masterRaster</code>) from either defaults of provided by the user.
From the rasters, <code>pixelGroup</code> are created which are unique combinations of the rasters values.
<code>pixelGroup</code> is a main processing unit in SpaDES <code>CBM</code> simulations.
In a first step, a <code>spatialDT</code> which is a <code>data.table</code> listing all pixels with their respective values of <code>raster</code>, <code>pixelIndex</code> and <code>pixelGroup</code> is created (<code>sim$spatialDT</code>).
From the <code>spatialDT</code>, a reduced <code>data.table</code> is create (<code>sim$level3DT</code>) which is the data.table from which processing will start in <code>CBM_core</code>.
The number of records in this data.table (<code>sim$level3DT</code>) should equal the number of pixel groups that will be processed in the spinup event of the <code>CBM_core</code> module.
This present module also creates variables of the same length as the rows in <code>level3DT</code> for use in other events of the <code>CBM_core</code> module.
These are: <code>returnIntervals</code>, <code>maxRotations</code>, <code>minRotations</code>, <code>lastPassDMIDs</code>, <code>historicDMIDs</code>, and delays all stored in the <code>simList.</code></p>
<p>Another important object created in this module is <code>mySpuDmids</code>.
This <code>data.table</code> links the user-defined disturbances (<code>$userDist</code>) with a spatial unit and a disturbance matrix.
This will be used to apply disturbances to pixel groups in the annual event of the <code>CBM_core</code> module.
The <code>mySpuDmids</code> object is created starting from a user provided list of disturbances (<code>userDist</code>) that matches the <code>rasterId</code> of the disturbance raster to the disturbance name, and speficies if the disturbance is stand-replacing (<code>userDist$wholeStand == 1</code>) or not (<code>userDist$wholeStand == 1</code>).
The disturbance names (<code>userDist$distName</code>) and their location of the disturbance (linked via the rasterID to the <code>sim$mySpuDmids$spatial_unit id</code>) are used to associate a disturbance matrix identification number to the disturbed <code>pixelGroup</code>.
Disturbance Matrices (DM) determine what proportion of a carbon pool gets transferred to another carbon pool via disturbance.
There are 426 matrix IDs in the present default data (<code>sim$processes$disturbanceMatrices</code>).
DMIDs (Disturbance Matrix IDs) are part of the default data of CBM-CFS3.
DMs are specific to spatial units which are a numbering (48 of them <code>sim$cbmData@spatialUnitIds</code>) of the overlay of the administrative boundaries and ecozones in Canada.
Spatial units are central units in CBM-CFS3, as are ecozones because both determining various ecological and other parameters that will be used in simulations via the <code>CBM_core</code> module.
The proportion of carbon transferred by a specific DMID can be found here <code>sim$cbmData@disturbanceMatrixValues</code>.
A series of R-functions were built to help users associate the correct disturbance matrices (<code>spuDist()</code>, <code>mySpu()</code>, <code>seeDist()</code>, <code>simDist()</code>) and are searchable in this package.</p>
<p>Note: * CBM_defaults objects are recreated in the <code>.inputObject</code> of this module * nothing is in carbon or carbon increments at this point.
This module feeds into the CBM_core module as does the CBM_vol2biomass.R module.</p>
</div>
<div id="usage-2" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Usage<a class="anchor" aria-label="anchor" href="#usage-2"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://spades-core.predictiveecology.org/">SpaDES.core</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">moduleDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">inputDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">moduleDir</span>, <span class="st">"inputs"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">reproducible</span><span class="fu">::</span><span class="fu">checkPath</span><span class="op">(</span>create <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">outputDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">moduleDir</span>, <span class="st">"outputs"</span><span class="op">)</span></span>
<span><span class="va">cacheDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">outputDir</span>, <span class="st">"cache"</span><span class="op">)</span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0</span>, end <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="co">#CBM_dataPrep = list(.useCache = ".inputObjects")</span></span>
<span> <span class="co">#.progress = list(type = "text", interval = 1), # for a progress bar</span></span>
<span> <span class="co">## If there are further modules, each can have its own set of parameters:</span></span>
<span> <span class="co">#module1 = list(param1 = value1, param2 = value2),</span></span>
<span> <span class="co">#module2 = list(param1 = value1, param2 = value2)</span></span>
<span> <span class="op">)</span></span>
<span><span class="va">modules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"CBM_dataPrep_SK"</span><span class="op">)</span></span>
<span><span class="va">objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  userDistFile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">moduleDir</span>, <span class="st">"CBM_dataPrep_SK"</span>, <span class="st">"data"</span>, <span class="st">"userDist.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  cachePath <span class="op">=</span> <span class="va">cacheDir</span>,</span>
<span>  modulePath <span class="op">=</span> <span class="va">moduleDir</span>,</span>
<span>  inputPath <span class="op">=</span> <span class="va">inputDir</span>,</span>
<span>  outputPath <span class="op">=</span> <span class="va">outputDir</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">myInputs</span> <span class="op">&lt;-</span> <span class="fu">simInit</span><span class="op">(</span>times <span class="op">=</span> <span class="va">times</span>, params <span class="op">=</span> <span class="va">parameters</span>, modules <span class="op">=</span> <span class="va">modules</span>,</span>
<span>                    objects <span class="op">=</span> <span class="va">objects</span>, paths <span class="op">=</span> <span class="va">paths</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outInputs</span> <span class="op">&lt;-</span> <span class="fu">spades</span><span class="op">(</span><span class="va">myInputs</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="events-1" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Events<a class="anchor" aria-label="anchor" href="#events-1"><i class="fas fa-link"></i></a>
</h2>
<p>There is only when event (init) is this module.</p>
</div>
<div id="data-dependencies-1" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Data dependencies<a class="anchor" aria-label="anchor" href="#data-dependencies-1"><i class="fas fa-link"></i></a>
</h2>
<div id="module-parameters" class="section level3" number="3.4.1">
<h3>
<span class="header-section-number">3.4.1</span> Module parameters<a class="anchor" aria-label="anchor" href="#module-parameters"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="input-data-1" class="section level3" number="3.4.2">
<h3>
<span class="header-section-number">3.4.2</span> Input data<a class="anchor" aria-label="anchor" href="#input-data-1"><i class="fas fa-link"></i></a>
</h3>
<p>An example with all the user-provided rasters and <code>.csv</code> files is provided by default.
The example simulates a region of the managed forests of SK.
All rasters and data frames for this example are on a cloud-drive (<code>userDefaultData_CBM_SK</code>).
Unless using this example, the user most provide:</p>
<ul>
<li>a raster of the study area at the desired resolution for simulation (<code>sim$masterRaster</code>)</li>
<li>an age raster (<code>sim$ageRaster</code>)</li>
<li>a raster indicating which growth curve should be applied to which pixels (<code>sim$gcIndexRaster</code>) or a URL for this raster (<code>sim$gcIndexRasterURL</code>).</li>
<li>raster of disturbances for each year the user wants disturbances to be simulated. This information could come from other SpaDES modules (fireSence, other fire modules, insects modules, etc.). For retrospective simulation (past to present), rasters found here can be used anywhere in Canada <a href="https://opendata.nfis.org/downloads/forest_change/CA_forest_harvest_mask_year_1985_2015.zip" class="uri">https://opendata.nfis.org/downloads/forest_change/CA_forest_harvest_mask_year_1985_2015.zip</a>.</li>
<li>a <code>.csv</code> file of the growth curve for the study area (with links to the <code>sim$gcIndexRaster</code>), <code>sim$userGcM3.csv</code> or the location of this file (<code>sim$userGcM3File</code>). The <code>sim$userGcM3.csv</code> file is required to have three columns:
<ul>
<li>“GrowthCurveComponentID”, which will be the link to the raster <code>sim$gcIndexRaster</code>,</li>
<li>“Age” ranging from 0 to the maximum age of the growth curve, and</li>
<li>“MerchVolume” which is the cumulative value of m3/ha at each age along each growth curve.</li>
</ul>
</li>
<li>a file with the disturbances to be applied as well as their raster values (<code>sim$userDist</code>) or its location (<code>sim$userDistFile</code>). The <code>userDist.csv</code> file must have three columns:
<ul>
<li>“distName” representing a simple description of the disturbance type (e.g., fire, clearcut, deforestation, etc.).</li>
<li>“rasterId” which indications the value that this specific disturbance will have on the disturbance raster.</li>
<li>“wholeStand” indicating if the disturbance is stand-replacing disturbance (1) or a partial disturbance (0).</li>
</ul>
</li>
</ul>
<p>The user could provide: * a raster of the ecozones in their study area (<code>sim$ecoRaster</code>), but the script will calculate this raster based on the <code>sim$masterRaster</code> if it is not provided.
* a raster of the spatial units (<code>sim$spuRaster</code>) but the script will calculate this raster based on the <code>sim$masterRaster</code> if it is not provided.</p>
</div>
<div id="output-data-1" class="section level3" number="3.4.3">
<h3>
<span class="header-section-number">3.4.3</span> Output data<a class="anchor" aria-label="anchor" href="#output-data-1"><i class="fas fa-link"></i></a>
</h3>
</div>
</div>
<div id="links-to-other-modules-1" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Links to other modules<a class="anchor" aria-label="anchor" href="#links-to-other-modules-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://github.com/PredictiveEcology/CBM_core"><code>CBM_core</code></a></li>
<li><a href="https://github.com/PredictiveEcology/CBM_defaults"><code>CBM_defaults</code></a></li>
<li><a href="https://github.com/PredictiveEcology/CBM_vol2biomass"><code>CBM_vol2biomass</code></a></li>
</ul>
<!-- TODO: cleanup and format this file
     * one sentence per line
     * use backticks for code formatting
     * remane modules!
-->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="cbm_defaults.html"><span class="header-section-number">2</span> CBM_defaults</a></div>
<div class="next"><a href="cbm_vol2biomass.html"><span class="header-section-number">4</span> CBM_vol2biomass</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cbm_dataprep_sk"><span class="header-section-number">3</span> CBM_dataPrep_SK</a></li>
<li><a class="nav-link" href="#overview-1"><span class="header-section-number">3.1</span> Overview</a></li>
<li><a class="nav-link" href="#usage-2"><span class="header-section-number">3.2</span> Usage</a></li>
<li><a class="nav-link" href="#events-1"><span class="header-section-number">3.3</span> Events</a></li>
<li>
<a class="nav-link" href="#data-dependencies-1"><span class="header-section-number">3.4</span> Data dependencies</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#module-parameters"><span class="header-section-number">3.4.1</span> Module parameters</a></li>
<li><a class="nav-link" href="#input-data-1"><span class="header-section-number">3.4.2</span> Input data</a></li>
<li><a class="nav-link" href="#output-data-1"><span class="header-section-number">3.4.3</span> Output data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#links-to-other-modules-1"><span class="header-section-number">3.5</span> Links to other modules</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/camillegiuliano/CBMspadesManual/blob/master/modules/CBM_dataPrep_SK/CBM_dataPrep_SK.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/camillegiuliano/CBMspadesManual/edit/master/modules/CBM_dataPrep_SK/CBM_dataPrep_SK.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>CBM Spades Manual</strong>: v. 0.1" was written by . It was last built on 26 June 2024.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
