[{"path":"index.html","id":"about","chapter":"1 About","heading":"1 About","text":"sample book written Markdown. can use anything Pandoc’s Markdown supports; example, math equation \\(^2 + b^2 = c^2\\).","code":""},{"path":"index.html","id":"usage","chapter":"1 About","heading":"1.1 Usage","text":"bookdown chapter .Rmd file, .Rmd file can contain one (one) chapter. chapter must start first-level heading: # good chapter, can contain one (one) first-level heading.Use second-level higher headings within chapters like: ## short section ### even shorter section.index.Rmd file required, also first book chapter. homepage render book.","code":""},{"path":"cbm_defaults.html","id":"cbm_defaults","chapter":"2 CBM_defaults","heading":"2 CBM_defaults","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .","code":""},{"path":"cbm_defaults.html","id":"overview","chapter":"2 CBM_defaults","heading":"2.1 Overview","text":"CBM_defaults reads default parameters managed forest Canada. SpaDES-speak, one event (init). , module provides R-based access defaults CBM parametersfor managed forests Canada. part spadesCBM, provides simulations default parameter values managed forests Canada, akin Archive Index CBM-CFS3 documentation. parameters read SQLite database (link ), defaults, modified CBM-CFS3 accommodate capacity flexible representation vegetation dynamics enable libcbm Python functions used, available . Defaults managed forests Canada include disturbance data different disturbance types IDs, spinup parameters, pool names, . outputs module used CBM_dataPrep_SK CBM_core spadesCBM simulations.","code":""},{"path":"cbm_defaults.html","id":"list-of-input-objects","chapter":"2 CBM_defaults","heading":"2.2 List of input objects","text":"","code":""},{"path":"cbm_defaults.html","id":"module-functioning","chapter":"2 CBM_defaults","heading":"2.3 Module functioning","text":"SQLite database, selection cbm_exn resource files downloaded stored user’s Inputs folder GitHub using reproducible::prepInputs function, useful tool SpaDES toolkit.Parameters necessary spadesCBM simulations extracted downloaded files. saved objects simList (see list output objects ).species_tr object created match species name provided growth curve.disturbanceMatrix cTransfers objects help identify carbon transfers matches provided disturbances matches transfer matrix IDs proportions transferred disturbance names.Parameters spinup event CBM_core modules assembled spinupSQL object.pooldef gives names carbon pool exists CBM.Objects narrow parameter selection study area spuLocator ecolocator","code":""},{"path":"cbm_defaults.html","id":"list-of-output-objects","chapter":"2 CBM_defaults","heading":"2.4 List of output objects","text":"","code":""},{"path":"cbm_defaults.html","id":"background","chapter":"2 CBM_defaults","heading":"2.5 Background","text":"example uses default parameters created use CBM-CFS3. parameters source references. ones outline Operational-scale Carbon Budget Model Canadian Forest Sector (CBM-CFS3) version 1.2: user’s guide. CBM_defaults brings parameters R-environment, easy user-access modifications.","code":""},{"path":"cbm_defaults.html","id":"usage-1","chapter":"2 CBM_defaults","heading":"2.6 Usage","text":"module can run independently running global script . Run independently, provides transparent access tp default parameters managed forests Canada CBM simulations.","code":"\nprojectPath <- \"~/CBM_defaults\"\nrepos <- c(\"predictiveecology.r-universe.dev\", getOption(\"repos\"))\nif ((packageVersion(\"SpaDES.project\") < \"0.1.1\" || packageVersion(\"Require\") < \"1.0.1.9002\") |>\n    tryCatch(error = function(x) TRUE))\n  install.packages(c(\"SpaDES.project\", \"Require\"), repos = repos)\n\nout <- SpaDES.project::setupProject(\n  paths = list(projectPath = projectPath),\n  \n  options = options(\n    repos = c(repos = repos),\n    reproducible.destinationPath = \"inputs\"\n  ),\n  modules =  c(\"PredictiveEcology/CBM_defaults@main\"),\n  require = c(\"SpaDES.core\"),\n)\n\noutDefaults <- SpaDES.core::simInitAndSpades2(out)"},{"path":"cbm_dataprep_sk.html","id":"cbm_dataprep_sk","chapter":"3 CBM_dataPrep_SK","heading":"3 CBM_dataPrep_SK","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .","code":""},{"path":"cbm_dataprep_sk.html","id":"overview-1","chapter":"3 CBM_dataPrep_SK","heading":"3.1 Overview","text":"CBM_dataPrep_SK processes spatially explicit inputs use CBM_vol2biomass CBM_core. SpaDES-speak, one event (init).SpaDES designed spatially explicit modelling provides wide variety tools support . CBM_dataPrep_SK processes spatially explicit inputs spadesCBM, making use tools. information study area scenario specific making CBM_dataPrep_SK idiosyncratic module spadesCBM deck. Users capacity define simulation inputs provide CBM_dataPrep_SK. default example simulates present day (1985-2011) scenario remotely-sensed disturbances simulated managed forests Saskatchewan, described @boisvenue2016’s (scenario = time horizon + disturbances).","code":""},{"path":"cbm_dataprep_sk.html","id":"inputs","chapter":"3 CBM_dataPrep_SK","heading":"3.2 Inputs","text":"default structure SpaDES modules .inputObjects function, .inputObjects function CBM_dataPrep_SK, make use reproducible::prepInputs function important part SpaDES toolkit (see SpaDES training, tools enable repeadability reproducibility (@McIntire2022). CBM_dataPrep_SK falls back defaults running SK managed forests, unless alternative information provided user. defaults give example users can developed scenarios .study area defined object masterRaster. object can provided directly raster, per example, created shape files means user. R-code can replace current input processing examples CBM_dataPrep_SK. characteristics (projection, resolution, etc.) masterRaster transferred rasters used simulation via function reproducible::prepInputs. example, age raster (ageRaster), raster specifying growth curves used (gcIndexRaster), location rasters link back default parameters Canada (spuRaster, ecoRaster), yearly disturbance rasters (provided list module disturbanceRaster, process annual event CBM_core module using function reproducible::postProcess, part reproducible::prepInputs function) matched masterRaster. Defaults parameters expected CBM_defaults (spinupSQL, species_tr) one table provided cbmAdminfor user convenience. addition location (study area) inventory information (age, provided raster), user expected provide: growth curves (\\(m^3/ha\\)) linked pixel stand (userGcM3), leading species curve (gcMeta), information disturbances (userDist).","code":""},{"path":"cbm_dataprep_sk.html","id":"module-functioning-1","chapter":"3 CBM_dataPrep_SK","heading":"3.3 Module functioning","text":"Two central pieces processed CBM_dataPrep_SK: pixelGroups created named disturbances matched disturbance matrices.pixelGroup unique combinations age, growth curve (means species), spatial unit ecozone. pixels identical age, growth curve, spatial unit ecozone share one pixelGroup number. object spatialDT long-form simulated pixel line, level3DT lists pixel groups. example 1,347,529 pixels simulated grouped 739 pixelGroups actual processing. Parameters necessary CBM_core spinup added level3DT object using output object spinupSQL CBM_defaults.user identifies disturbances occur landscape simulations. example points file (userGcM3) disturbance name description, matches number raster provide identify disturbances (one per year since simulations yearly), identifies disturbance whole stand disturbance . disturbances need match disturbance matrix, identifies proportion carbon transferred one pool (source pool) another pool (sink pool) disturbance occurs specific pixel study area. something else defaults used, user prompted select list disturbance matrices available study area, spatial unit ecozone combinations. matrices provided Canada-wide defaults region (spatial unit ecozone) specific, read-CBM_defaults available CBM_dataPrep_SK module via simList(). provide example selection example. user-prompts look like :\nMAYBE INSERT SCREEN SHOTS disturbance SELECTION PROCESS?468 unique disturbance matrices identified defaults. Since root parameters snag carbon transfer rates differ hardwood softwood model, disturbance hardwood softwood instance, means really 234 unique disturbances across Canada defaults modelling system, one hardwood one softwood. user add modify proportions transferred pools represent disturbance (NOTE HAPPEN CSVs, even work? libcbm point files? change ? QUESTION SCOTT).\nAdd section one modify disturbance matricesThere series helper functions CBMutils help users explore navigate disturbance matrices: spuDist extracting disturbances specific spatial unit, simDist() lists distrubances used simulation, seeDist() pulls proportions source sink pools.growth curves can identified strata, multiple columns can used identify growth curves using curveID object. example, one column used, “gcids”.","code":""},{"path":"cbm_dataprep_sk.html","id":"list-of-output-objects-1","chapter":"3 CBM_dataPrep_SK","heading":"3.4 List of output objects","text":"","code":""},{"path":"cbm_dataprep_sk.html","id":"links-to-other-modules","chapter":"3 CBM_dataPrep_SK","heading":"3.5 Links to other modules","text":"CBM_coreCBM_defaultsCBM_vol2biomass","code":""},{"path":"cbm_vol2biomass.html","id":"cbm_vol2biomass","chapter":"4 CBM_vol2biomass","heading":"4 CBM_vol2biomass","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .","code":""},{"path":"cbm_vol2biomass.html","id":"overview-2","chapter":"4 CBM_vol2biomass","heading":"4.1 Overview","text":"","code":""},{"path":"cbm_vol2biomass.html","id":"list-of-input-objects-1","chapter":"4 CBM_vol2biomass","heading":"4.2 List of input objects","text":"","code":""},{"path":"cbm_vol2biomass.html","id":"list-of-output-objects-2","chapter":"4 CBM_vol2biomass","heading":"4.3 List of output objects","text":"","code":""},{"path":"cbm_vol2biomass.html","id":"module-flow-rename-this-section-later","chapter":"4 CBM_vol2biomass","heading":"4.4 Module flow (rename this section later)","text":"","code":""},{"path":"cbm_vol2biomass.html","id":"old-version","chapter":"4 CBM_vol2biomass","heading":"4.5 OLD VERSION","text":"","code":""},{"path":"cbm_vol2biomass.html","id":"overview-3","chapter":"4 CBM_vol2biomass","heading":"4.6 Overview","text":"module translates m3/ha values biomass/ha increments spadesCBMcore needs simulate annual carbon fluxes estimate stocks spadesCBMcore.R module spadesCBM.\nimplementation Boudewyn et al 2007 stand-level translation.\nLike many statistical models, translation always successful.\nscripts line translation procedure CBM-CFS3 addition smoothing methods using Generalized Additive Models (GAMs).\nmodule provides two examples smoothing methods: one applied cumulative carbon/ha curves (merch, foliage, growth curves provided), one applied increment curves (differences betwee years cumulative curves).\nresponsibility user decide curves smoothing methods appropriate. module can run independently spadesCBM deck SpaDES modules.","code":""},{"path":"cbm_vol2biomass.html","id":"user-input","chapter":"4 CBM_vol2biomass","heading":"4.6.1 User input","text":"user must provide two files growth information one location file.\nNote can provided spadesCBMinputs module spadesCBM deck used: * one metadata file (userGcMeta) minimum identifier links specific growth curve pixel study area raster (gcId - growth curve identification number) leading species curve.\n* one file gives m3 per ha age identified growth curves.\n* location information file.\ninformation preferably passed along raster spadesCBMinputs module, can -passed providing vector ecozones spatial units growth curves apply .\ninformation used identify jurisdiction (province territory) ecozone gcId , turn used determine appropriate parameters stand-level conversion m3/ha biomass per ha Boudewyn et al. approach.","code":""},{"path":"cbm_vol2biomass.html","id":"default-files-provided","chapter":"4 CBM_vol2biomass","heading":"4.6.2 Default files provided","text":"Two types information built module: Boudewyn et al. parameters tables, data frames help link CBM-specific information parameter categories.\n* URLs Boudewyn et al. five parameter tables built module (see .inputObjects) loaded NFIS site directly.\n* cbmAdmin data frame links CBM-specific spatial units administrative boundaries Canada ecozones.\n* canfi_species data frame provides canfi_species numbers genus abbreviations used identify correct parameters Boudewyn et al tables.\nalso specifies name tree species forest_type_id, identifier used CBM.","code":""},{"path":"cbm_vol2biomass.html","id":"pseudocode-the-general-steps","chapter":"4 CBM_vol2biomass","heading":"4.6.3 Pseudocode: the general steps","text":"module reads user userGcMeta, reads userGcM3.\nprovides plot curves userGcM3 visual inspection (sim$volCurves).\nmatches jurisdiction gcId (growth curve identification), matches leading species attaching canfi_species (number) genus leading species.\ncanfi_species genus key associating correct parameters conversion (Boudewyn et al. 2007).\nspecies matches complete, series functions (see package CBMutils) used go provided cumulative m3/ha curve cumulative tonnes carbon/ha ground live biomass pool (merch, foliage, ).\nvisual check provided via sim$plotsRawCumulativeBiomass.\nSince time models need smoothing, two examples smoothing, applied Saskatchewan default example, provided fitting GAMs 1) cumulative curve (per gcId) three pool, 2) fitting GAMs increments years three pools.\nCurrently, example 1) commented , example 2) used show sometimes, even perfect-looking curves need hard fixes.\nexamplee, default knots GAMs set 20 (k=20) extra weight given 0 intercept maximum value curve setting weights (wts script).\nSee http://environmentalcomputing.net/intro--gams/ guide GAMs.\n, user’s responsibility decided smoothing parameters /methods appropriate.\ndefault example 1) (commented ), fitted values GAMs cumulative curves carbon/ha used calculate annual increment, dived two use spadesCBMcore.R module annual processing (half growth processes two instances).\nHalved increments can visually assessed using sim$checkInc halved increments save simList (sim$growth_increments).\nexample 2), currently executed default Saskatchewan example, increments calculated prior fitting GAMs.\nfinal step (examples), halved growth increment table hashed processing speed (sim$gcHash).\nmodule uses example region Saskatchewan default simulation can modified run independently (.e., just translation m3 ground carbon three pools).","code":""},{"path":"cbm_vol2biomass.html","id":"units","chapter":"4 CBM_vol2biomass","heading":"4.6.4 Units","text":"user provides growth curves cumulative m3/ha time one leading species (following CBM-CFS3).\ncurves fed Boudewyn algorithms (CBM_vol2biomass module) results multiplied 0.5 give carbon/ha.\ndeck modules simulates annual basis preferable cumulative curves m3/ha provided individual years.\nper individual years, GAM fitted values modified provide yearly fitted.values.\nobject cumPoolsRaw (line 411) CBM_vol2biomass.R, cumulative values three -ground live pools tonnes carbon/ha.\nfollowing values tonnes c/ha.","code":""},{"path":"cbm_vol2biomass.html","id":"output","chapter":"4 CBM_vol2biomass","heading":"4.6.5 Output","text":"module provides sim$growth_increments hashed version, sim$gcHash available spadesCBMcore module.\noutput created module visual checks growth curve processing.","code":""},{"path":"cbm_vol2biomass.html","id":"spades","chapter":"4 CBM_vol2biomass","heading":"4.6.6 SpaDES","text":"one event module (init), module scheduled .\nmodule designed part SpaDES-deck spadesCBM, SpaDES modules representing CBM-CFS3, transparent spatialized.\nfour modules family: spadesCBMdefaults, spadesSBMinputs, CBM_vol2biomass, spadesCBMcore.","code":""},{"path":"cbm_vol2biomass.html","id":"list-of-potential-improvements","chapter":"4 CBM_vol2biomass","heading":"4.6.7 list of potential improvements","text":"add check see growth curves provided annual basis , modify GAM outputs provided annual fitted value.make k (knots GAMs) user defined parameterprovide option fit GAM prior maximum value curve (0 max) number knots (k) one maximum value possibly knots.previous weights going GAMs.","code":""},{"path":"cbm_vol2biomass.html","id":"usage-2","chapter":"4 CBM_vol2biomass","heading":"4.7 Usage","text":"","code":"\nlibrary(SpaDES)\nlibrary(magrittr) # this is needed to use \"%>%\" below\nmoduleDir <- \"C:/Celine/github/spadesCBM\"\ninputDir <- file.path(moduleDir, \"inputs\") %>% reproducible::checkPath(create = TRUE)\noutputDir <- file.path(moduleDir, \"outputs\")\ncacheDir <- file.path(outputDir, \"cache\")\ntimes <- list(start = 0, end = 10)\n\nparameters <- list(\n  CBM_vol2biomass = list(.useCache = \".inputObjects\")\n  #.progress = list(type = \"text\", interval = 1), # for a progress bar\n  ## If there are further modules, each can have its own set of parameters:\n  #module1 = list(param1 = value1, param2 = value2),\n  #module2 = list(param1 = value1, param2 = value2)\n)\n\nmodules <- list(\"CBM_vol2biomass\")\nobjects <- list(\n  #userGcMetafileName <- c(\"/RIA2019/gcMetaRuns.csv\"),\n  #userGcM3 <- c(\"/RIA2019/gcRIAm3.csv\")\n\n)\npaths <- list(\n  cachePath = cacheDir,\n  modulePath = moduleDir,\n  inputPath = inputDir,\n  outputPath = outputDir\n)\noptions(\n    rasterTmpDir = inputDir,\n    reproducible.cachePath = cacheDir,\n    spades.inputPath = inputDir,\n    spades.outputPath = outputDir,\n    spades.modulePath = moduleDir\n  )\n\nmyBiomass <- simInit(times = times, params = parameters, modules = modules,\n                 objects = objects)\n\nmyBiomassOut <- spades(myBiomass)"},{"path":"cbm_core.html","id":"cbm_core","chapter":"5 CBM_core","heading":"5 CBM_core","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .","code":""},{"path":"cbm_core.html","id":"overview-4","chapter":"5 CBM_core","heading":"5.1 Overview","text":"core modules Spades CBM.","code":""},{"path":"cbm_core.html","id":"notes-on-forest-type","chapter":"5 CBM_core","heading":"5.1.1 Notes on forest type","text":"SQligth (used CBM_defaults) column named forest_type_id identifies softwood forest (sw) 1, mixed forest 2, hardwood forest (hw) 3. distinction important determines root biomass calculated (sw differently hw). definition fotrest_type_id constant used canfi_species.csv (species level identification codes needed volumne biomass translation CBM_vol2biomass), gcMeta.csv (SK specific growth curve metadata), sim$growth_increments built gcMeta canfi_species. sim$growth_increment$forest_type_id one used create sw flag needed input spinup event. , sw_hw flag (1=sw, 0=hw) stored sim$cbm_vars$state$sw_hw column.","code":""},{"path":"cbm_core.html","id":"list-of-input-objects-2","chapter":"5 CBM_core","heading":"5.2 List of input objects","text":"","code":""},{"path":"cbm_core.html","id":"list-of-output-objects-3","chapter":"5 CBM_core","heading":"5.3 List of output objects","text":"","code":""},{"path":"cbm_core.html","id":"module-flow-rename-this-section-later-1","chapter":"5 CBM_core","heading":"5.4 Module flow (rename this section later)","text":"","code":""},{"path":"cbm_core.html","id":"old-version-1","chapter":"5 CBM_core","heading":"5.5 OLD VERSION","text":"","code":""},{"path":"cbm_core.html","id":"overview-5","chapter":"5 CBM_core","heading":"5.6 Overview","text":"NPP: Net primary productivity ground productivity. Provide overview module / use module.","code":""},{"path":"references.html","id":"references","chapter":"References","heading":"References","text":"","code":""}]
